# –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –ò–∑–±—ã—Ç–æ—á–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö + —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–°—Ç–∞—Ä–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Frontend (EventDetector) ‚Üí –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è
- Backend ‚Üí –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è

**–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Frontend ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –í–°–ï —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (GPS + –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä)
- Backend ‚Üí –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç ‚Üí –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç ‚Üí —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** - –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
2. **ML –æ–±—É—á–µ–Ω–∏–µ** - –≤—Å–µ —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
5. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** - –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –Ω–æ–≤—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (raw_sensor_data)
```json
{
  "deviceId": "mobile-app-123",
  "timestamp": "2025-11-12T20:00:00Z",
  "latitude": 55.751244,
  "longitude": 37.618423,
  "speed": 45.5,
  "accuracy": 5.2,
  "altitude": 150,
  "accelerometer_x": 0.123,
  "accelerometer_y": 9.8,
  "accelerometer_z": -0.456,
  "created_at": "2025-11-12T20:00:01Z"
}
```

### 2. –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (processed_events)
```json
{
  "id": "uuid",
  "deviceId": "mobile-app-123",
  "timestamp": "2025-11-12T20:00:00Z",
  "eventType": "pothole",
  "severity": 2,
  "confidence": 0.85,
  "latitude": 55.751244,
  "longitude": 37.618423,
  "speed": 45.5,
  "accelerometer_x": 0.123,
  "accelerometer_y": 9.8,
  "accelerometer_z": -0.456,
  "accelerometer_magnitude": 12.5,
  "accelerometer_deltaY": 3.2,
  "accelerometer_deltaZ": 2.8,
  "accelerometer_variance": 1.2,
  "roadType": "asphalt",
  "created_at": "2025-11-12T20:00:01Z"
}
```

### 3. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (user_warnings)
```json
{
  "id": "uuid",
  "deviceId": "mobile-app-123",
  "eventType": "pothole",
  "severity": 2,
  "latitude": 55.751244,
  "longitude": 37.618423,
  "distance": 150,
  "message": "–í–´–°–û–ö–û–ï: –Ø–ú–ê —á–µ—Ä–µ–∑ 150–º",
  "expiresAt": "2025-11-12T20:05:00Z",
  "created_at": "2025-11-12T20:00:01Z"
}
```

## üîå API Endpoints

### POST /api/raw-data
–û—Ç–ø—Ä–∞–≤–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**Request:**
```json
{
  "deviceId": "mobile-app-123",
  "data": [
    {
      "deviceId": "mobile-app-123",
      "timestamp": 1699814400000,
      "gps": {
        "latitude": 55.751244,
        "longitude": 37.618423,
        "speed": 45.5,
        "accuracy": 5.2,
        "altitude": 150
      },
      "accelerometer": {
        "x": 0.123,
        "y": 9.8,
        "z": -0.456
      }
    }
  ]
}
```

**Response:**
```json
{
  "message": "Raw data processed successfully",
  "rawDataSaved": 10,
  "eventsDetected": 2,
  "warningsGenerated": 1,
  "warnings": [
    {
      "id": "uuid",
      "eventType": "pothole",
      "severity": 2,
      "distance": 150,
      "message": "–í–´–°–û–ö–û–ï: –Ø–ú–ê —á–µ—Ä–µ–∑ 150–º",
      "expiresAt": "2025-11-12T20:05:00Z"
    }
  ]
}
```

### GET /api/warnings/{device_id}
–ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**Response:**
```json
{
  "deviceId": "mobile-app-123",
  "count": 2,
  "warnings": [
    {
      "id": "uuid",
      "eventType": "pothole",
      "severity": 2,
      "message": "–í–´–°–û–ö–û–ï: –Ø–ú–ê —á–µ—Ä–µ–∑ 150–º",
      "distance": 150,
      "expiresAt": "2025-11-12T20:05:00Z"
    }
  ]
}
```

### DELETE /api/warnings/{warning_id}
–£–¥–∞–ª–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

**Response:**
```json
{
  "message": "Warning dismissed"
}
```

## ü§ñ ML Processor

### EventClassifier
–ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞

**–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:**
- `pothole` - —è–º–∞ (—Ä–µ–∑–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ Y –∏ Z)
- `braking` - —Ä–µ–∑–∫–æ–µ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ Y –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏)
- `bump` - –Ω–µ—Ä–æ–≤–Ω–æ—Å—Ç—å/–±—É–≥–æ—Ä (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ Z)
- `vibration` - –≤–∏–±—Ä–∞—Ü–∏—è/–ø–ª–æ—Ö–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (–≤—ã—Å–æ–∫–∞—è –≤–∞—Ä–∏–∞—Ü–∏—è)
- `normal` - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ

**Severity (1-5):**
- 1 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ
- 2 - –í—ã—Å–æ–∫–æ–µ
- 3 - –°—Ä–µ–¥–Ω–µ–µ
- 4 - –ù–∏–∑–∫–æ–µ
- 5 - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ

**–ü–æ—Ä–æ–≥–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```python
thresholds = {
    'pothole': {'deltaY': 3.0, 'deltaZ': 2.5, 'magnitude': 12.0},
    'braking': {'deltaY': 2.0, 'magnitude': 11.0},
    'bump': {'deltaZ': 2.0, 'magnitude': 11.5},
    'vibration': {'variance': 0.8, 'magnitude': 10.5}
}
```

### WarningGenerator
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `warning_distance` - 200 –º–µ—Ç—Ä–æ–≤ (—Ä–∞–¥–∏—É—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
- `warning_ttl` - 1 —á–∞—Å (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)

**–£—Å–ª–æ–≤–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- Severity <= 2 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏ –≤—ã—Å–æ–∫–∏–µ —Å–æ–±—ã—Ç–∏—è)
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Å–æ–±—ã—Ç–∏—è <= 200 –º–µ—Ç—Ä–æ–≤

## üì± Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è (TODO)

### –ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å: RawDataCollector

```typescript
class RawDataCollector {
  private collectInterval = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã
  private sendBatchSize = 5; // –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 5 —Ç–æ—á–µ–∫
  
  collectData() {
    // –°–æ–±–∏—Ä–∞—Ç—å GPS + –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    // –ù–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –≤ –±–∞—Ç—á
    // –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –±–∞—Ç—á –Ω–∞ /api/raw-data
  }
  
  processWarnings(warnings) {
    // –ü–æ–ª—É—á–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–ª–µ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å –∑–≤—É–∫
  }
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ index.tsx

1. **–£–±—Ä–∞—Ç—å EventDetector** –∏–∑ —Ü–µ–ø–æ—á–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
2. **–î–æ–±–∞–≤–∏—Ç—å RawDataCollector** –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
3. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π** –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
4. **–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** –≤ UI —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ –∑–≤—É–∫–∞–º–∏

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Backend
- ‚úÖ –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ ML –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Å–æ–∑–¥–∞–Ω (`ml_processor.py`)
- ‚úÖ –ù–æ–≤—ã–µ endpoints –¥–æ–±–∞–≤–ª–µ–Ω—ã (`/api/raw-data`, `/api/warnings/{device_id}`)
- ‚úÖ MongoDB –∫–æ–ª–ª–µ–∫—Ü–∏–∏: `raw_sensor_data`, `processed_events`, `user_warnings`

### Frontend (TODO)
- ‚è≥ –°–æ–∑–¥–∞—Ç—å RawDataCollector
- ‚è≥ –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚è≥ –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
1. **–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö** - —Å–∫–æ–ª—å–∫–æ —Å—ã—Ä—ã—Ö —Ç–æ—á–µ–∫ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ –º–∏–Ω—É—Ç—É
2. **–ß–∞—Å—Ç–æ—Ç–∞ —Å–æ–±—ã—Ç–∏–π** - —Å–∫–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–π –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è
3. **–¢–æ—á–Ω–æ—Å—Ç—å** - —Å–∫–æ–ª—å–∫–æ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
4. **–ó–∞–¥–µ—Ä–∂–∫–∞** - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞—Ç—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
5. **–ê–¥–∞–ø—Ç–∞—Ü–∏—è** - –∫–∞–∫ –º–µ–Ω—è—é—Ç—Å—è –ø–æ—Ä–æ–≥–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## üî¨ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∫–∞–∂–¥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
2. **ML –º–æ–¥–µ–ª—å** - –æ–±—É—á–µ–Ω–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –Ω–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **Crowd-sourcing** - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **Real-time –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** - WebSocket –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤
5. **–ö–∞—Ä—Ç–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
6. **–†–µ–π—Ç–∏–Ω–≥ –¥–æ—Ä–æ–≥** - –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–æ—Ä–æ–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
