{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":134},"end":{"line":7,"column":52,"index":186}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/ObstacleService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":187},"end":{"line":8,"column":72,"index":259}}],"key":"OL8ihlfm2XA1VJRGp8nx4ivCCi0=","exportNames":["*"],"imports":1}},{"name":"../services/AudioAlertService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":260},"end":{"line":9,"column":62,"index":322}}],"key":"B8YQ9t0yVqfoMo222gmz6jUWFBE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  /**\n   * useObstacleAlerts - Хук для управления оповещениями о препятствиях\n   * \n   * Интегрирует ObstacleService и AudioAlertService\n   */\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.useObstacleAlerts = useObstacleAlerts;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesObstacleService = require(_dependencyMap[1], \"../services/ObstacleService\");\n  var obstacleService = _interopDefault(_servicesObstacleService);\n  var _servicesAudioAlertService = require(_dependencyMap[2], \"../services/AudioAlertService\");\n  var audioAlertService = _interopDefault(_servicesAudioAlertService);\n  function useObstacleAlerts(isTracking, currentLocation, currentSpeed) {\n    _s();\n    const [obstacles, setObstacles] = (0, _react.useState)([]);\n    const [closestObstacle, setClosestObstacle] = (0, _react.useState)(null);\n    const fetchInterval = (0, _react.useRef)(null);\n    const lastAlertedObstacles = (0, _react.useRef)(new Set());\n\n    // Загрузка препятствий каждые 30 секунд\n    (0, _react.useEffect)(() => {\n      if (!isTracking || !currentLocation) {\n        return;\n      }\n      const fetchObstacles = async () => {\n        try {\n          const lat = currentLocation.coords.latitude;\n          const lon = currentLocation.coords.longitude;\n          const nearbyObstacles = await obstacleService.default.fetchNearbyObstacles(lat, lon, 5000,\n          // 5 км радиус\n          1 // минимум 1 подтверждение\n          );\n          setObstacles(nearbyObstacles);\n\n          // Находим ближайшее\n          const closest = obstacleService.default.getClosestObstacle(nearbyObstacles);\n          setClosestObstacle(closest);\n\n          // Проверяем нужны ли оповещения\n          checkForAlerts(nearbyObstacles);\n        } catch (error) {\n          console.error('❌ Error fetching obstacles:', error);\n        }\n      };\n\n      // Загружаем сразу\n      fetchObstacles();\n\n      // И каждые 30 секунд\n      fetchInterval.current = setInterval(fetchObstacles, 30000);\n      return () => {\n        if (fetchInterval.current) {\n          clearInterval(fetchInterval.current);\n        }\n      };\n    }, [isTracking, currentLocation?.coords?.latitude, currentLocation?.coords?.longitude]);\n\n    // Проверка и выдача аудио-оповещений\n    const checkForAlerts = async obstacleList => {\n      // Обновляем скорость в аудио-сервисе\n      audioAlertService.default.updateSpeed(currentSpeed);\n      for (const obstacle of obstacleList) {\n        // Пропускаем если уже оповещали\n        if (lastAlertedObstacles.current.has(obstacle.id)) {\n          continue;\n        }\n\n        // Проверяем нужно ли оповещение\n        if (audioAlertService.default.shouldAlert(obstacle, currentSpeed)) {\n          // Выдаем оповещение\n          await audioAlertService.default.alert(obstacle, currentSpeed);\n\n          // Помечаем как оповещенное\n          lastAlertedObstacles.current.add(obstacle.id);\n\n          // Очищаем через 60 секунд (чтобы не повторять слишком часто)\n          setTimeout(() => {\n            lastAlertedObstacles.current.delete(obstacle.id);\n            audioAlertService.default.clearAlert(obstacle.id);\n          }, 60000);\n        }\n      }\n    };\n\n    // Очистка при остановке\n    (0, _react.useEffect)(() => {\n      if (!isTracking) {\n        audioAlertService.default.clearAllAlerts();\n        lastAlertedObstacles.current.clear();\n        setObstacles([]);\n        setClosestObstacle(null);\n      }\n    }, [isTracking]);\n    return {\n      obstacles,\n      closestObstacle,\n      obstaclesCount: obstacles.length\n    };\n  }\n  _s(useObstacleAlerts, \"CcYD+94WrjQqed1rZCchgTYmOY0=\");\n});","lineCount":112,"map":[[5,2,1,0],[6,0,2,0],[7,0,3,0],[8,0,4,0],[9,0,5,0],[10,2,1,0,"Object"],[10,8,1,0],[10,9,1,0,"defineProperty"],[10,23,1,0],[10,24,1,0,"exports"],[10,31,1,0],[11,4,1,0,"value"],[11,9,1,0],[12,2,1,0],[13,2,1,0],[13,11,1,0,"_interopDefault"],[13,27,1,0,"e"],[13,28,1,0],[14,4,1,0],[14,11,1,0,"e"],[14,12,1,0],[14,16,1,0,"e"],[14,17,1,0],[14,18,1,0,"__esModule"],[14,28,1,0],[14,31,1,0,"e"],[14,32,1,0],[15,6,1,0,"default"],[15,13,1,0],[15,15,1,0,"e"],[16,4,1,0],[17,2,1,0],[18,2,11,0,"exports"],[18,9,11,0],[18,10,11,0,"useObstacleAlerts"],[18,27,11,0],[18,30,11,0,"useObstacleAlerts"],[18,47,11,0],[19,2,7,0],[19,6,7,0,"_react"],[19,12,7,0],[19,15,7,0,"require"],[19,22,7,0],[19,23,7,0,"_dependencyMap"],[19,37,7,0],[20,2,8,0],[20,6,8,0,"_servicesObstacleService"],[20,30,8,0],[20,33,8,0,"require"],[20,40,8,0],[20,41,8,0,"_dependencyMap"],[20,55,8,0],[21,2,8,0],[21,6,8,0,"obstacleService"],[21,21,8,0],[21,24,8,0,"_interopDefault"],[21,39,8,0],[21,40,8,0,"_servicesObstacleService"],[21,64,8,0],[22,2,9,0],[22,6,9,0,"_servicesAudioAlertService"],[22,32,9,0],[22,35,9,0,"require"],[22,42,9,0],[22,43,9,0,"_dependencyMap"],[22,57,9,0],[23,2,9,0],[23,6,9,0,"audioAlertService"],[23,23,9,0],[23,26,9,0,"_interopDefault"],[23,41,9,0],[23,42,9,0,"_servicesAudioAlertService"],[23,68,9,0],[24,2,11,7],[24,11,11,16,"useObstacleAlerts"],[24,28,11,33,"useObstacleAlerts"],[24,29,12,2,"isTracking"],[24,39,12,21],[24,41,13,2,"currentLocation"],[24,56,13,22],[24,58,14,2,"currentSpeed"],[24,70,14,22],[24,72,15,2],[25,4,15,2,"_s"],[25,6,15,2],[26,4,16,2],[26,10,16,8],[26,11,16,9,"obstacles"],[26,20,16,18],[26,22,16,20,"setObstacles"],[26,34,16,32],[26,35,16,33],[26,38,16,36],[26,42,16,36,"useState"],[26,48,16,44],[26,49,16,44,"useState"],[26,57,16,44],[26,59,16,57],[26,61,16,59],[26,62,16,60],[27,4,17,2],[27,10,17,8],[27,11,17,9,"closestObstacle"],[27,26,17,24],[27,28,17,26,"setClosestObstacle"],[27,46,17,44],[27,47,17,45],[27,50,17,48],[27,54,17,48,"useState"],[27,60,17,56],[27,61,17,56,"useState"],[27,69,17,56],[27,71,17,74],[27,75,17,78],[27,76,17,79],[28,4,18,2],[28,10,18,8,"fetchInterval"],[28,23,18,21],[28,26,18,24],[28,30,18,24,"useRef"],[28,36,18,30],[28,37,18,30,"useRef"],[28,43,18,30],[28,45,18,54],[28,49,18,58],[28,50,18,59],[29,4,19,2],[29,10,19,8,"lastAlertedObstacles"],[29,30,19,28],[29,33,19,31],[29,37,19,31,"useRef"],[29,43,19,37],[29,44,19,37,"useRef"],[29,50,19,37],[29,52,19,51],[29,56,19,55,"Set"],[29,59,19,58],[29,60,19,59],[29,61,19,60],[29,62,19,61],[31,4,21,2],[32,4,22,2],[32,8,22,2,"useEffect"],[32,14,22,11],[32,15,22,11,"useEffect"],[32,24,22,11],[32,26,22,12],[32,32,22,18],[33,6,23,4],[33,10,23,8],[33,11,23,9,"isTracking"],[33,21,23,19],[33,25,23,23],[33,26,23,24,"currentLocation"],[33,41,23,39],[33,43,23,41],[34,8,24,6],[35,6,25,4],[36,6,27,4],[36,12,27,10,"fetchObstacles"],[36,26,27,24],[36,29,27,27],[36,35,27,27,"fetchObstacles"],[36,36,27,27],[36,41,27,39],[37,8,28,6],[37,12,28,10],[38,10,29,8],[38,16,29,14,"lat"],[38,19,29,17],[38,22,29,20,"currentLocation"],[38,37,29,35],[38,38,29,36,"coords"],[38,44,29,42],[38,45,29,43,"latitude"],[38,53,29,51],[39,10,30,8],[39,16,30,14,"lon"],[39,19,30,17],[39,22,30,20,"currentLocation"],[39,37,30,35],[39,38,30,36,"coords"],[39,44,30,42],[39,45,30,43,"longitude"],[39,54,30,52],[40,10,32,8],[40,16,32,14,"nearbyObstacles"],[40,31,32,29],[40,34,32,32],[40,40,32,38,"obstacleService"],[40,55,32,53],[40,56,32,53,"default"],[40,63,32,53],[40,64,32,54,"fetchNearbyObstacles"],[40,84,32,74],[40,85,33,10,"lat"],[40,88,33,13],[40,90,34,10,"lon"],[40,93,34,13],[40,95,35,10],[40,99,35,14],[41,10,35,16],[42,10,36,10],[42,11,36,11],[42,12,36,12],[43,10,37,8],[43,11,37,9],[44,10,39,8,"setObstacles"],[44,22,39,20],[44,23,39,21,"nearbyObstacles"],[44,38,39,36],[44,39,39,37],[46,10,41,8],[47,10,42,8],[47,16,42,14,"closest"],[47,23,42,21],[47,26,42,24,"obstacleService"],[47,41,42,39],[47,42,42,39,"default"],[47,49,42,39],[47,50,42,40,"getClosestObstacle"],[47,68,42,58],[47,69,42,59,"nearbyObstacles"],[47,84,42,74],[47,85,42,75],[48,10,43,8,"setClosestObstacle"],[48,28,43,26],[48,29,43,27,"closest"],[48,36,43,34],[48,37,43,35],[50,10,45,8],[51,10,46,8,"checkForAlerts"],[51,24,46,22],[51,25,46,23,"nearbyObstacles"],[51,40,46,38],[51,41,46,39],[52,8,47,6],[52,9,47,7],[52,10,47,8],[52,17,47,15,"error"],[52,22,47,20],[52,24,47,22],[53,10,48,8,"console"],[53,17,48,15],[53,18,48,16,"error"],[53,23,48,21],[53,24,48,22],[53,53,48,51],[53,55,48,53,"error"],[53,60,48,58],[53,61,48,59],[54,8,49,6],[55,6,50,4],[55,7,50,5],[57,6,52,4],[58,6,53,4,"fetchObstacles"],[58,20,53,18],[58,21,53,19],[58,22,53,20],[60,6,55,4],[61,6,56,4,"fetchInterval"],[61,19,56,17],[61,20,56,18,"current"],[61,27,56,25],[61,30,56,28,"setInterval"],[61,41,56,39],[61,42,56,40,"fetchObstacles"],[61,56,56,54],[61,58,56,56],[61,63,56,61],[61,64,56,62],[62,6,58,4],[62,13,58,11],[62,19,58,17],[63,8,59,6],[63,12,59,10,"fetchInterval"],[63,25,59,23],[63,26,59,24,"current"],[63,33,59,31],[63,35,59,33],[64,10,60,8,"clearInterval"],[64,23,60,21],[64,24,60,22,"fetchInterval"],[64,37,60,35],[64,38,60,36,"current"],[64,45,60,43],[64,46,60,44],[65,8,61,6],[66,6,62,4],[66,7,62,5],[67,4,63,2],[67,5,63,3],[67,7,63,5],[67,8,63,6,"isTracking"],[67,18,63,16],[67,20,63,18,"currentLocation"],[67,35,63,33],[67,37,63,35,"coords"],[67,43,63,41],[67,45,63,43,"latitude"],[67,53,63,51],[67,55,63,53,"currentLocation"],[67,70,63,68],[67,72,63,70,"coords"],[67,78,63,76],[67,80,63,78,"longitude"],[67,89,63,87],[67,90,63,88],[67,91,63,89],[69,4,65,2],[70,4,66,2],[70,10,66,8,"checkForAlerts"],[70,24,66,22],[70,27,66,25],[70,33,66,32,"obstacleList"],[70,45,66,56],[70,49,66,61],[71,6,67,4],[72,6,68,4,"audioAlertService"],[72,23,68,21],[72,24,68,21,"default"],[72,31,68,21],[72,32,68,22,"updateSpeed"],[72,43,68,33],[72,44,68,34,"currentSpeed"],[72,56,68,46],[72,57,68,47],[73,6,70,4],[73,11,70,9],[73,17,70,15,"obstacle"],[73,25,70,23],[73,29,70,27,"obstacleList"],[73,41,70,39],[73,43,70,41],[74,8,71,6],[75,8,72,6],[75,12,72,10,"lastAlertedObstacles"],[75,32,72,30],[75,33,72,31,"current"],[75,40,72,38],[75,41,72,39,"has"],[75,44,72,42],[75,45,72,43,"obstacle"],[75,53,72,51],[75,54,72,52,"id"],[75,56,72,54],[75,57,72,55],[75,59,72,57],[76,10,73,8],[77,8,74,6],[79,8,76,6],[80,8,77,6],[80,12,77,10,"audioAlertService"],[80,29,77,27],[80,30,77,27,"default"],[80,37,77,27],[80,38,77,28,"shouldAlert"],[80,49,77,39],[80,50,77,40,"obstacle"],[80,58,77,48],[80,60,77,50,"currentSpeed"],[80,72,77,62],[80,73,77,63],[80,75,77,65],[81,10,78,8],[82,10,79,8],[82,16,79,14,"audioAlertService"],[82,33,79,31],[82,34,79,31,"default"],[82,41,79,31],[82,42,79,32,"alert"],[82,47,79,37],[82,48,79,38,"obstacle"],[82,56,79,46],[82,58,79,48,"currentSpeed"],[82,70,79,60],[82,71,79,61],[84,10,81,8],[85,10,82,8,"lastAlertedObstacles"],[85,30,82,28],[85,31,82,29,"current"],[85,38,82,36],[85,39,82,37,"add"],[85,42,82,40],[85,43,82,41,"obstacle"],[85,51,82,49],[85,52,82,50,"id"],[85,54,82,52],[85,55,82,53],[87,10,84,8],[88,10,85,8,"setTimeout"],[88,20,85,18],[88,21,85,19],[88,27,85,25],[89,12,86,10,"lastAlertedObstacles"],[89,32,86,30],[89,33,86,31,"current"],[89,40,86,38],[89,41,86,39,"delete"],[89,47,86,45],[89,48,86,46,"obstacle"],[89,56,86,54],[89,57,86,55,"id"],[89,59,86,57],[89,60,86,58],[90,12,87,10,"audioAlertService"],[90,29,87,27],[90,30,87,27,"default"],[90,37,87,27],[90,38,87,28,"clearAlert"],[90,48,87,38],[90,49,87,39,"obstacle"],[90,57,87,47],[90,58,87,48,"id"],[90,60,87,50],[90,61,87,51],[91,10,88,8],[91,11,88,9],[91,13,88,11],[91,18,88,16],[91,19,88,17],[92,8,89,6],[93,6,90,4],[94,4,91,2],[94,5,91,3],[96,4,93,2],[97,4,94,2],[97,8,94,2,"useEffect"],[97,14,94,11],[97,15,94,11,"useEffect"],[97,24,94,11],[97,26,94,12],[97,32,94,18],[98,6,95,4],[98,10,95,8],[98,11,95,9,"isTracking"],[98,21,95,19],[98,23,95,21],[99,8,96,6,"audioAlertService"],[99,25,96,23],[99,26,96,23,"default"],[99,33,96,23],[99,34,96,24,"clearAllAlerts"],[99,48,96,38],[99,49,96,39],[99,50,96,40],[100,8,97,6,"lastAlertedObstacles"],[100,28,97,26],[100,29,97,27,"current"],[100,36,97,34],[100,37,97,35,"clear"],[100,42,97,40],[100,43,97,41],[100,44,97,42],[101,8,98,6,"setObstacles"],[101,20,98,18],[101,21,98,19],[101,23,98,21],[101,24,98,22],[102,8,99,6,"setClosestObstacle"],[102,26,99,24],[102,27,99,25],[102,31,99,29],[102,32,99,30],[103,6,100,4],[104,4,101,2],[104,5,101,3],[104,7,101,5],[104,8,101,6,"isTracking"],[104,18,101,16],[104,19,101,17],[104,20,101,18],[105,4,103,2],[105,11,103,9],[106,6,104,4,"obstacles"],[106,15,104,13],[107,6,105,4,"closestObstacle"],[107,21,105,19],[108,6,106,4,"obstaclesCount"],[108,20,106,18],[108,22,106,20,"obstacles"],[108,31,106,29],[108,32,106,30,"length"],[109,4,107,2],[109,5,107,3],[110,2,108,0],[111,2,108,1,"_s"],[111,4,108,1],[111,5,11,16,"useObstacleAlerts"],[111,22,11,33],[112,0,11,33],[112,3]],"functionMap":{"names":["<global>","useObstacleAlerts","useEffect$argument_0","fetchObstacles","<anonymous>","checkForAlerts","setTimeout$argument_0"],"mappings":"AAA;OCU;YCW;2BCK;KDuB;WEQ;KFI;GDC;yBIG;mBCmB;SDG;GJG;YCG;GDO;CDO"},"hasCjsExports":false},"type":"js/module"}]}