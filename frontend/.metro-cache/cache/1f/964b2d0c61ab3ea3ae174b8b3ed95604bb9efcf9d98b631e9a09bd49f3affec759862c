{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":134},"end":{"line":7,"column":52,"index":186}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/ObstacleService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":8,"column":0,"index":187},"end":{"line":8,"column":72,"index":259}}],"key":"OL8ihlfm2XA1VJRGp8nx4ivCCi0=","exportNames":["*"],"imports":1}},{"name":"../services/AudioAlertService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":260},"end":{"line":9,"column":62,"index":322}}],"key":"B8YQ9t0yVqfoMo222gmz6jUWFBE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.useObstacleAlerts = useObstacleAlerts;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesObstacleService = require(_dependencyMap[1], \"../services/ObstacleService\");\n  var obstacleService = _interopDefault(_servicesObstacleService);\n  var _servicesAudioAlertService = require(_dependencyMap[2], \"../services/AudioAlertService\");\n  var audioAlertService = _interopDefault(_servicesAudioAlertService);\n  /**\n   * useObstacleAlerts - Хук для управления оповещениями о препятствиях\n   * \n   * Интегрирует ObstacleService и AudioAlertService\n   */\n\n  function useObstacleAlerts(isTracking, currentLocation, currentSpeed) {\n    const [obstacles, setObstacles] = (0, _react.useState)([]);\n    const [closestObstacle, setClosestObstacle] = (0, _react.useState)(null);\n    const fetchInterval = (0, _react.useRef)(null);\n    const lastAlertedObstacles = (0, _react.useRef)(new Set());\n\n    // Загрузка препятствий каждые 30 секунд\n    (0, _react.useEffect)(() => {\n      if (!isTracking || !currentLocation) {\n        return;\n      }\n      const fetchObstacles = async () => {\n        try {\n          const lat = currentLocation.coords.latitude;\n          const lon = currentLocation.coords.longitude;\n          const nearbyObstacles = await obstacleService.default.fetchNearbyObstacles(lat, lon, 5000,\n          // 5 км радиус\n          1 // минимум 1 подтверждение\n          );\n          setObstacles(nearbyObstacles);\n\n          // Находим ближайшее\n          const closest = obstacleService.default.getClosestObstacle(nearbyObstacles);\n          setClosestObstacle(closest);\n\n          // Проверяем нужны ли оповещения\n          checkForAlerts(nearbyObstacles);\n        } catch (error) {\n          console.error('❌ Error fetching obstacles:', error);\n        }\n      };\n\n      // Загружаем сразу\n      fetchObstacles();\n\n      // И каждые 30 секунд\n      fetchInterval.current = setInterval(fetchObstacles, 30000);\n      return () => {\n        if (fetchInterval.current) {\n          clearInterval(fetchInterval.current);\n        }\n      };\n    }, [isTracking, currentLocation?.coords?.latitude, currentLocation?.coords?.longitude]);\n\n    // Проверка и выдача аудио-оповещений\n    const checkForAlerts = async obstacleList => {\n      // Обновляем скорость в аудио-сервисе\n      audioAlertService.default.updateSpeed(currentSpeed);\n      for (const obstacle of obstacleList) {\n        // Пропускаем если уже оповещали\n        if (lastAlertedObstacles.current.has(obstacle.id)) {\n          continue;\n        }\n\n        // Проверяем нужно ли оповещение\n        if (audioAlertService.default.shouldAlert(obstacle, currentSpeed)) {\n          // Выдаем оповещение\n          await audioAlertService.default.alert(obstacle, currentSpeed);\n\n          // Помечаем как оповещенное\n          lastAlertedObstacles.current.add(obstacle.id);\n\n          // Очищаем через 60 секунд (чтобы не повторять слишком часто)\n          setTimeout(() => {\n            lastAlertedObstacles.current.delete(obstacle.id);\n            audioAlertService.default.clearAlert(obstacle.id);\n          }, 60000);\n        }\n      }\n    };\n\n    // Очистка при остановке\n    (0, _react.useEffect)(() => {\n      if (!isTracking) {\n        audioAlertService.default.clearAllAlerts();\n        lastAlertedObstacles.current.clear();\n        setObstacles([]);\n        setClosestObstacle(null);\n      }\n    }, [isTracking]);\n    return {\n      obstacles,\n      closestObstacle,\n      obstaclesCount: obstacles.length\n    };\n  }\n});","lineCount":110,"map":[[12,2,11,0,"exports"],[12,9,11,0],[12,10,11,0,"useObstacleAlerts"],[12,27,11,0],[12,30,11,0,"useObstacleAlerts"],[12,47,11,0],[13,2,7,0],[13,6,7,0,"_react"],[13,12,7,0],[13,15,7,0,"require"],[13,22,7,0],[13,23,7,0,"_dependencyMap"],[13,37,7,0],[14,2,8,0],[14,6,8,0,"_servicesObstacleService"],[14,30,8,0],[14,33,8,0,"require"],[14,40,8,0],[14,41,8,0,"_dependencyMap"],[14,55,8,0],[15,2,8,0],[15,6,8,0,"obstacleService"],[15,21,8,0],[15,24,8,0,"_interopDefault"],[15,39,8,0],[15,40,8,0,"_servicesObstacleService"],[15,64,8,0],[16,2,9,0],[16,6,9,0,"_servicesAudioAlertService"],[16,32,9,0],[16,35,9,0,"require"],[16,42,9,0],[16,43,9,0,"_dependencyMap"],[16,57,9,0],[17,2,9,0],[17,6,9,0,"audioAlertService"],[17,23,9,0],[17,26,9,0,"_interopDefault"],[17,41,9,0],[17,42,9,0,"_servicesAudioAlertService"],[17,68,9,0],[18,2,1,0],[19,0,2,0],[20,0,3,0],[21,0,4,0],[22,0,5,0],[24,2,11,7],[24,11,11,16,"useObstacleAlerts"],[24,28,11,33,"useObstacleAlerts"],[24,29,12,2,"isTracking"],[24,39,12,21],[24,41,13,2,"currentLocation"],[24,56,13,22],[24,58,14,2,"currentSpeed"],[24,70,14,22],[24,72,15,2],[25,4,16,2],[25,10,16,8],[25,11,16,9,"obstacles"],[25,20,16,18],[25,22,16,20,"setObstacles"],[25,34,16,32],[25,35,16,33],[25,38,16,36],[25,42,16,36,"useState"],[25,48,16,44],[25,49,16,44,"useState"],[25,57,16,44],[25,59,16,57],[25,61,16,59],[25,62,16,60],[26,4,17,2],[26,10,17,8],[26,11,17,9,"closestObstacle"],[26,26,17,24],[26,28,17,26,"setClosestObstacle"],[26,46,17,44],[26,47,17,45],[26,50,17,48],[26,54,17,48,"useState"],[26,60,17,56],[26,61,17,56,"useState"],[26,69,17,56],[26,71,17,74],[26,75,17,78],[26,76,17,79],[27,4,18,2],[27,10,18,8,"fetchInterval"],[27,23,18,21],[27,26,18,24],[27,30,18,24,"useRef"],[27,36,18,30],[27,37,18,30,"useRef"],[27,43,18,30],[27,45,18,54],[27,49,18,58],[27,50,18,59],[28,4,19,2],[28,10,19,8,"lastAlertedObstacles"],[28,30,19,28],[28,33,19,31],[28,37,19,31,"useRef"],[28,43,19,37],[28,44,19,37,"useRef"],[28,50,19,37],[28,52,19,51],[28,56,19,55,"Set"],[28,59,19,58],[28,60,19,59],[28,61,19,60],[28,62,19,61],[30,4,21,2],[31,4,22,2],[31,8,22,2,"useEffect"],[31,14,22,11],[31,15,22,11,"useEffect"],[31,24,22,11],[31,26,22,12],[31,32,22,18],[32,6,23,4],[32,10,23,8],[32,11,23,9,"isTracking"],[32,21,23,19],[32,25,23,23],[32,26,23,24,"currentLocation"],[32,41,23,39],[32,43,23,41],[33,8,24,6],[34,6,25,4],[35,6,27,4],[35,12,27,10,"fetchObstacles"],[35,26,27,24],[35,29,27,27],[35,35,27,27,"fetchObstacles"],[35,36,27,27],[35,41,27,39],[36,8,28,6],[36,12,28,10],[37,10,29,8],[37,16,29,14,"lat"],[37,19,29,17],[37,22,29,20,"currentLocation"],[37,37,29,35],[37,38,29,36,"coords"],[37,44,29,42],[37,45,29,43,"latitude"],[37,53,29,51],[38,10,30,8],[38,16,30,14,"lon"],[38,19,30,17],[38,22,30,20,"currentLocation"],[38,37,30,35],[38,38,30,36,"coords"],[38,44,30,42],[38,45,30,43,"longitude"],[38,54,30,52],[39,10,32,8],[39,16,32,14,"nearbyObstacles"],[39,31,32,29],[39,34,32,32],[39,40,32,38,"obstacleService"],[39,55,32,53],[39,56,32,53,"default"],[39,63,32,53],[39,64,32,54,"fetchNearbyObstacles"],[39,84,32,74],[39,85,33,10,"lat"],[39,88,33,13],[39,90,34,10,"lon"],[39,93,34,13],[39,95,35,10],[39,99,35,14],[40,10,35,16],[41,10,36,10],[41,11,36,11],[41,12,36,12],[42,10,37,8],[42,11,37,9],[43,10,39,8,"setObstacles"],[43,22,39,20],[43,23,39,21,"nearbyObstacles"],[43,38,39,36],[43,39,39,37],[45,10,41,8],[46,10,42,8],[46,16,42,14,"closest"],[46,23,42,21],[46,26,42,24,"obstacleService"],[46,41,42,39],[46,42,42,39,"default"],[46,49,42,39],[46,50,42,40,"getClosestObstacle"],[46,68,42,58],[46,69,42,59,"nearbyObstacles"],[46,84,42,74],[46,85,42,75],[47,10,43,8,"setClosestObstacle"],[47,28,43,26],[47,29,43,27,"closest"],[47,36,43,34],[47,37,43,35],[49,10,45,8],[50,10,46,8,"checkForAlerts"],[50,24,46,22],[50,25,46,23,"nearbyObstacles"],[50,40,46,38],[50,41,46,39],[51,8,47,6],[51,9,47,7],[51,10,47,8],[51,17,47,15,"error"],[51,22,47,20],[51,24,47,22],[52,10,48,8,"console"],[52,17,48,15],[52,18,48,16,"error"],[52,23,48,21],[52,24,48,22],[52,53,48,51],[52,55,48,53,"error"],[52,60,48,58],[52,61,48,59],[53,8,49,6],[54,6,50,4],[54,7,50,5],[56,6,52,4],[57,6,53,4,"fetchObstacles"],[57,20,53,18],[57,21,53,19],[57,22,53,20],[59,6,55,4],[60,6,56,4,"fetchInterval"],[60,19,56,17],[60,20,56,18,"current"],[60,27,56,25],[60,30,56,28,"setInterval"],[60,41,56,39],[60,42,56,40,"fetchObstacles"],[60,56,56,54],[60,58,56,56],[60,63,56,61],[60,64,56,62],[61,6,58,4],[61,13,58,11],[61,19,58,17],[62,8,59,6],[62,12,59,10,"fetchInterval"],[62,25,59,23],[62,26,59,24,"current"],[62,33,59,31],[62,35,59,33],[63,10,60,8,"clearInterval"],[63,23,60,21],[63,24,60,22,"fetchInterval"],[63,37,60,35],[63,38,60,36,"current"],[63,45,60,43],[63,46,60,44],[64,8,61,6],[65,6,62,4],[65,7,62,5],[66,4,63,2],[66,5,63,3],[66,7,63,5],[66,8,63,6,"isTracking"],[66,18,63,16],[66,20,63,18,"currentLocation"],[66,35,63,33],[66,37,63,35,"coords"],[66,43,63,41],[66,45,63,43,"latitude"],[66,53,63,51],[66,55,63,53,"currentLocation"],[66,70,63,68],[66,72,63,70,"coords"],[66,78,63,76],[66,80,63,78,"longitude"],[66,89,63,87],[66,90,63,88],[66,91,63,89],[68,4,65,2],[69,4,66,2],[69,10,66,8,"checkForAlerts"],[69,24,66,22],[69,27,66,25],[69,33,66,32,"obstacleList"],[69,45,66,56],[69,49,66,61],[70,6,67,4],[71,6,68,4,"audioAlertService"],[71,23,68,21],[71,24,68,21,"default"],[71,31,68,21],[71,32,68,22,"updateSpeed"],[71,43,68,33],[71,44,68,34,"currentSpeed"],[71,56,68,46],[71,57,68,47],[72,6,70,4],[72,11,70,9],[72,17,70,15,"obstacle"],[72,25,70,23],[72,29,70,27,"obstacleList"],[72,41,70,39],[72,43,70,41],[73,8,71,6],[74,8,72,6],[74,12,72,10,"lastAlertedObstacles"],[74,32,72,30],[74,33,72,31,"current"],[74,40,72,38],[74,41,72,39,"has"],[74,44,72,42],[74,45,72,43,"obstacle"],[74,53,72,51],[74,54,72,52,"id"],[74,56,72,54],[74,57,72,55],[74,59,72,57],[75,10,73,8],[76,8,74,6],[78,8,76,6],[79,8,77,6],[79,12,77,10,"audioAlertService"],[79,29,77,27],[79,30,77,27,"default"],[79,37,77,27],[79,38,77,28,"shouldAlert"],[79,49,77,39],[79,50,77,40,"obstacle"],[79,58,77,48],[79,60,77,50,"currentSpeed"],[79,72,77,62],[79,73,77,63],[79,75,77,65],[80,10,78,8],[81,10,79,8],[81,16,79,14,"audioAlertService"],[81,33,79,31],[81,34,79,31,"default"],[81,41,79,31],[81,42,79,32,"alert"],[81,47,79,37],[81,48,79,38,"obstacle"],[81,56,79,46],[81,58,79,48,"currentSpeed"],[81,70,79,60],[81,71,79,61],[83,10,81,8],[84,10,82,8,"lastAlertedObstacles"],[84,30,82,28],[84,31,82,29,"current"],[84,38,82,36],[84,39,82,37,"add"],[84,42,82,40],[84,43,82,41,"obstacle"],[84,51,82,49],[84,52,82,50,"id"],[84,54,82,52],[84,55,82,53],[86,10,84,8],[87,10,85,8,"setTimeout"],[87,20,85,18],[87,21,85,19],[87,27,85,25],[88,12,86,10,"lastAlertedObstacles"],[88,32,86,30],[88,33,86,31,"current"],[88,40,86,38],[88,41,86,39,"delete"],[88,47,86,45],[88,48,86,46,"obstacle"],[88,56,86,54],[88,57,86,55,"id"],[88,59,86,57],[88,60,86,58],[89,12,87,10,"audioAlertService"],[89,29,87,27],[89,30,87,27,"default"],[89,37,87,27],[89,38,87,28,"clearAlert"],[89,48,87,38],[89,49,87,39,"obstacle"],[89,57,87,47],[89,58,87,48,"id"],[89,60,87,50],[89,61,87,51],[90,10,88,8],[90,11,88,9],[90,13,88,11],[90,18,88,16],[90,19,88,17],[91,8,89,6],[92,6,90,4],[93,4,91,2],[93,5,91,3],[95,4,93,2],[96,4,94,2],[96,8,94,2,"useEffect"],[96,14,94,11],[96,15,94,11,"useEffect"],[96,24,94,11],[96,26,94,12],[96,32,94,18],[97,6,95,4],[97,10,95,8],[97,11,95,9,"isTracking"],[97,21,95,19],[97,23,95,21],[98,8,96,6,"audioAlertService"],[98,25,96,23],[98,26,96,23,"default"],[98,33,96,23],[98,34,96,24,"clearAllAlerts"],[98,48,96,38],[98,49,96,39],[98,50,96,40],[99,8,97,6,"lastAlertedObstacles"],[99,28,97,26],[99,29,97,27,"current"],[99,36,97,34],[99,37,97,35,"clear"],[99,42,97,40],[99,43,97,41],[99,44,97,42],[100,8,98,6,"setObstacles"],[100,20,98,18],[100,21,98,19],[100,23,98,21],[100,24,98,22],[101,8,99,6,"setClosestObstacle"],[101,26,99,24],[101,27,99,25],[101,31,99,29],[101,32,99,30],[102,6,100,4],[103,4,101,2],[103,5,101,3],[103,7,101,5],[103,8,101,6,"isTracking"],[103,18,101,16],[103,19,101,17],[103,20,101,18],[104,4,103,2],[104,11,103,9],[105,6,104,4,"obstacles"],[105,15,104,13],[106,6,105,4,"closestObstacle"],[106,21,105,19],[107,6,106,4,"obstaclesCount"],[107,20,106,18],[107,22,106,20,"obstacles"],[107,31,106,29],[107,32,106,30,"length"],[108,4,107,2],[108,5,107,3],[109,2,108,0],[110,0,108,1],[110,3]],"functionMap":{"names":["<global>","useObstacleAlerts","useEffect$argument_0","fetchObstacles","<anonymous>","checkForAlerts","setTimeout$argument_0"],"mappings":"AAA;OCU;YCW;2BCK;KDuB;WEQ;KFI;GDC;yBIG;mBCmB;SDG;GJG;YCG;GDO;CDO"},"hasCjsExports":false},"type":"js/module"}]}